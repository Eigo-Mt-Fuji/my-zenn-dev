---
title: "[Rust]ä»Šæ—¥ã®å­¦ã³2022-08-16 - ãƒœãƒƒã‚¯ã‚¹åŒ–ã¯ã©ã®ã‚ˆã†ãªå ´åˆã«è¡Œã†ã®ã‹(åˆæ­©çš„æ„è¨³ã¨ç·´ç¿’)"
emoji: "ğŸ”¥"
type: "tech" 
topics: ["Rust"]
published: true
---

ã“ã‚Œã¯å€‹äººçš„ãªç·´ç¿’ã®ãƒãƒ¼ãƒˆã§ã™ã€‚
é–“é•ã£ã¦ã„ãŸå ´åˆã¯ã”ã‚ã‚“ãªã•ã„ã€‚
å¾¡æ‰‹æŸ”ã‚‰ã‹ã«ãŠé¡˜ã„ã—ã¾ã™ã€‚ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è²°ãˆã‚‹ã¨å–œã³ã¾ã™ã€‚

## ã¯ã˜ã‚ã«

ä»Šå¹´ä¸­ã«ã€æ‰‹è¶³ã®ã‚ˆã†ã«Rustã‚’ä½¿ãˆã‚‹è‡ªä¿¡ã‚’ã¤ã‘ãŸãã¦
Effective Rustã‚’1ç« ãšã¤èª­ã‚“ã§ã„ãç›®æ¨™ã‚’ç«‹ã¦ã¾ã—ãŸã€‚

ãŸã ã€ãã‚Œã ã‘ã ã¨é£½ãã¦ã—ã¾ã†æã‚ŒãŒã‚ã‚‹ã€‚
ä¸å®‰ãªåŸºæœ¬éƒ¨åˆ†ã‚’å–ã‚Šå‡ºã—ã¦å’€åš¼ã—ãŸã‚Šç·´ç¿’ã‚’ã—ã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã€ãã®å‚™å¿˜éŒ²ã‚’å…¬é–‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

ä»Šæ—¥ã¯ãƒœãƒƒã‚¯ã‚¹åŒ–ã«ã¤ã„ã¦

- ãƒœãƒƒã‚¯ã‚¹åŒ–ã¯ã©ã®ã‚ˆã†ãªå ´åˆã«è¡Œã†ã®ã‹
  - ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹(è‹±æ–‡)ã‚’æ„è¨³ã™ã‚‹
- ç·´ç¿’: æ•´æ•°å‹ã‚’ä½¿ã£ãŸãƒœãƒƒã‚¯ã‚¹åŒ–
  - ç°¡å˜ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããªãŒã‚‰ç†è§£ã™ã‚‹

ã‚’ã‚„ã£ã¦ã„ãã¾ã™ã€‚

## å‚è€ƒæƒ…å ±

- [web.mit.edu - The Rust Programming Language(First Edition) - Effective Rust](https://web.mit.edu/rust-lang_v1.25/arch/amd64_ubuntu1404/share/doc/rust/html/book/first-edition/effective-rust.html)
- [doc.rust-jp.rs - rust-by-example-ja/scope/borrow - å€Ÿç”¨](https://doc.rust-jp.rs/rust-by-example-ja/scope/borrow.html)
- [doc.rust-lang.org/book/ch15-01-box.html - Using Box<T> to Point to Data on the Heap](https://doc.rust-lang.org/book/ch15-01-box.html#using-boxt-to-point-to-data-on-the-heap)

## æœ¬é¡Œ

### ãƒœãƒƒã‚¯ã‚¹åŒ–ã¯ã©ã®ã‚ˆã†ãªå ´åˆã«è¡Œã†ã®ã‹

- [Rust by example æ—¥æœ¬èªç‰ˆã®Box, ã‚¹ã‚¿ãƒƒã‚¯ã¨ãƒ’ãƒ¼ãƒ—](https://doc.rust-jp.rs/rust-by-example-ja/std/box.html)ã‚’èª­ã‚“ã 
  - ãƒœãƒƒã‚¯ã‚¹åŒ–ã¯ã€ã„ã‚ã‚†ã‚‹ã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ã€‚ãƒœãƒƒã‚¯ã‚¹åŒ–ã™ã‚‹ã“ã¨ã§æ„å›³çš„ã«ãƒ’ãƒ¼ãƒ—ä¸Šã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã“ã¨ã¯ç†è§£ã€‚

- ã©ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã§ãƒœãƒƒã‚¯ã‚¹åŒ–ã‚’æ„è­˜ã—ã¦è¡Œã†ã¹ãï¼ˆã‚ã‚‹ã„ã¯è¡Œã‚ãªã„ã¹ãï¼‰ã‹ã‚’çŸ¥ã‚ŠãŸã„
  - åŸºæœ¬çš„ã«ã¯ã€ãƒ’ãƒ¼ãƒ—ä¸Šã®é ˜åŸŸç¢ºä¿ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ã¨æ¯”ã¹ã‚‹ã¨é‡ãŸã„å‡¦ç†ã€‚ãƒœãƒƒã‚¯ã‚¹åŒ–(è¦ã™ã‚‹ã«ã€ãƒ’ãƒ¼ãƒ—ç¢ºä¿)ã‚’ã™ã‚‹ã¨ã€ã‚¹ã‚¿ãƒƒã‚¯ã®é«˜é€Ÿãªé ˜åŸŸç¢ºä¿ã®åˆ©ç‚¹ãŒå¤±ã‚ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ã€‚
    - æ„å›³çš„ã«ãƒ’ãƒ¼ãƒ—ä¸Šã®é ˜åŸŸç¢ºä¿ã‚’è€ƒãˆã‚‹ã¹ãã‚±ãƒ¼ã‚¹ã‚’é™¤ã„ã¦ã€ã‚„ã‚‰ãªã„ã»ã†ãŒã‚ˆã•ãã†ã¨ã„ã†èªè­˜ã—ã¦ã„ã‚‹ã€‚
  - ãã®ä¸Šã§ã€ã©ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã§ãƒœãƒƒã‚¯ã‚¹åŒ–ã‚’æ„è­˜ã—ã¦è¡Œã†ã¹ãï¼ˆã‚ã‚‹ã„ã¯è¡Œã‚ãªã„ã¹ãï¼‰ã‹ã‚’çŸ¥ã‚ŠãŸã„ã€‚

- doc.rust-lang.org(è‹±èªç‰ˆ)ã®èª¬æ˜ãŒã‚ã£ãŸã€‚æ„šç›´ã«ç¿»è¨³ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚
  - [doc.rust-lang.org/book/ch15-01-box.html - Using Box<T> to Point to Data on the Heap](https://doc.rust-lang.org/book/ch15-01-box.html#using-boxt-to-point-to-data-on-the-heap)
    - 3ã¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€‚æŠœç²‹ã—ã¤ã¤å€‹äººçš„ã«æ„è¨³ã—ãŸã€‚
        - Case1. When you have a large amount of data and you want to transfer ownership but ensure the data wonâ€™t be copied when you do so
            - å€‹äººçš„æ„è¨³: å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã£ã¦ãŠã‚Šã€ã‹ã¤ã€æ‰€æœ‰æ¨©ã®ç§»å‹•ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã€ãƒ‡ãƒ¼ã‚¿ã®ã‚³ãƒ”ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã“ã¨ã‚’ç¢ºå®Ÿã«ä¿è¨¼ã™ã‚‹ç›®çš„ã§ãƒœãƒƒã‚¯ã‚¹åŒ–ã‚’è¡Œã†
        - Case2. When you have a type whose size canâ€™t be known at compile time and you want to use a value of that type in a context that requires an exact size
            - å€‹äººçš„æ„è¨³: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚µã‚¤ã‚ºãŒã‚ã‹ã‚‰ãªã„å‹ã‚’æ‰±ã†å ´åˆï¼ˆã‹ã¤ã€ãã®å‹ã®å€¤ã®æ­£ç¢ºãªã‚µã‚¤ã‚ºãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹ï¼‰
        - Case3. When you want to own a value and you care only that itâ€™s a type that implements a particular trait rather than being of a specific type
            - å€‹äººçš„æ„è¨³: è‡ªåˆ†ã§å€¤ã®æ‰€æœ‰æ¨©ã‚’ä¿æŒã—ãŸã„å ´åˆã§ã€ã‹ã¤ã€ãã®å€¤ã®å…·ä½“çš„ãªå‹ã‚ˆã‚Šã‚‚ãã®å€¤ã®å‹ãŒãªã‚“ã‚‰ã‹ã®trait(æ€§è³ª)ãŒå®Ÿè£…ã—ãŸã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã®æ–¹ã‚’é‡è¦–ã—ãŸã„å ´åˆ
    - æ„Ÿæƒ³
      - Case1, Case2ã¯ãªã‚“ã¨ãªãã‚ã‹ã‚‹ã€‚Case3ã¯ã©ã®ç¨‹åº¦ç™ºç”Ÿã™ã‚‹ã‚±ãƒ¼ã‚¹ãªã®ã‹ç–‘å•ãŒæ®‹ã£ãŸã¾ã¾ã (å®Ÿè·µãŒå¿…è¦)
        - è‡ªåˆ†ã§å€¤ã®æ‰€æœ‰æ¨©ã‚’ä¿æŒã—ãŸã„å ´åˆã¯ã‚ã‹ã‚‰ãªã„ãŒã€traitã§æŠ½è±¡åŒ–ã—ã¦æ‰±ã†ã“ã¨ã¯ãã‚Œãªã‚Šã«ã‚ã‚Šãã†(æ„å¤–ã¨ã‚ˆãä½¿ã†ã®ã‹?)
          - å‚è€ƒã«ã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ¢ã—ã¦èª­ã‚“ã§ã¿ã‚ˆã†ã¨æ€ã†ã€‚

### [ç·´ç¿’: æ•´æ•°å‹ã‚’ä½¿ã£ãŸãƒœãƒƒã‚¯ã‚¹åŒ–](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&code=fn%20awesome_borrow_with_box(int_on_box_borrow%3A%20%26Box%3Ci32%3E)%20-%3E%20bool%20%7B%0A%20%20%20%20%0A%20%20%20%20%2F%2F%20%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B%20%E7%90%86%E7%94%B1%3A%20expected%20struct%20%60Box%60%2C%20found%20integer%0A%20%20%20%20%2F%2F%20*int_on_box_borrow%20%3D%20101%3B%0A%0A%20%20%20%20%2F%2F%20%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B%20%E7%90%86%E7%94%B1%3A%20cannot%20assign%20to%20%60**int_on_box_borrow%60%2C%20which%20is%20behind%20a%20%60%26%60%20reference%0A%20%20%20%20%2F%2F%20**int_on_box_borrow%20%3D%20101%3B%0A%0A%20%20%20%20println!(%22int%20with%20boxed%3A%20borrow%20%3D%20%7B%7D%22%2C%20int_on_box_borrow)%3B%0A%20%20%20%20true%0A%7D%0A%0Afn%20main()%20%7B%0A%0A%20%20%20%20%2F%2F%20%E9%80%9A%E5%B8%B8%E3%81%AEinteger(%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E4%B8%8A%E3%81%AB%E6%A0%BC%E7%B4%8D%E3%81%95%E3%82%8C%E3%82%8B)%0A%20%20%20%20let%20int_on_stack%3A%20i32%20%3D%20100%3B%0A%0A%20%20%20%20%2F%2F%20%E5%A4%89%E6%95%B0int_on_stack_copy%E3%81%AB%E3%82%B3%E3%83%94%E3%83%BC%20%E2%80%BB%E5%80%A4%E3%81%AE%E5%A4%89%E6%9B%B4%E7%A2%BA%E8%AA%8D%E3%81%AE%E3%81%9F%E3%82%81mut%E4%BF%AE%E9%A3%BE%E5%AD%90%E3%82%92%E4%BB%98%E4%B8%8E)%0A%20%20%20%20let%20mut%20int_on_stack_copy%20%3D%20int_on_stack%3B%0A%20%20%20%20println!(%22int%20on%20stack%3A%20copy%20is%20ok.%20original%20%3D%20%7B%7D%2C%20copy%20%3D%20%7B%7D.%22%2C%20int_on_stack%2C%20int_on_stack_copy)%3B%0A%20%20%20%20println!(%22int%20on%20stack%3A%20change%20value%20of%20int_on_stack_copy(from%20100%20to%2050).%22)%3B%0A%20%20%20%20%2F%2F%20%0A%20%20%20%20int_on_stack_copy%20%3D%2050%3B%0A%20%20%20%20println!(%22int%20on%20stack%3A%20copy%20is%20stored%20as%20different%20on%20stack.%20original%20%3D%20%7B%7D%2C%20copy%20%3D%20%7B%7D.%22%2C%20int_on_stack%2C%20int_on_stack_copy)%3B%0A%0A%20%20%20%20let%20mut%20int_on_box%3A%20Box%3Ci32%3E%20%3D%20std%3A%3Aboxed%3A%3ABox%3A%3Anew(100)%3B%0A%0A%20%20%20%20%2F%2F%20box%E5%8C%96%E3%81%97%E3%81%9F%E5%80%A4%E3%81%AE%E5%8F%82%E7%85%A7%E3%83%BB%E5%80%9F%E7%94%A8%E3%81%AE%E5%8B%95%E4%BD%9C%E3%82%92%E7%A2%BA%E8%AA%8D%0A%20%20%20%20let%20int_on_box_borrow_local%20%3D%20%26int_on_box%3B%0A%0A%20%20%20%20%2F%2F%20%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B%20%E7%90%86%E7%94%B1%3A%20cannot%20assign%20to%20%60*int_on_box%60%20because%20it%20is%20borrowed%20(L29%E3%81%AE%E5%8F%82%E7%85%A7%E3%81%A7%E5%80%A4%E3%81%8C%E5%80%9F%E7%94%A8%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E2%86%92%E5%85%83%E3%81%AE%E5%A4%89%E6%95%B0int_on_box%E3%81%AB%E6%96%B0%E3%81%97%E3%81%84%E5%80%A4%E3%82%92%E4%BB%A3%E5%85%A5%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84)%0A%20%20%20%20%2F%2F%20*int_on_box%20%3D%20102%3B%0A%0A%20%20%20%20%2F%2F%20%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B%20%E7%90%86%E7%94%B1%3A%20expected%20struct%20%60Box%60%2C%20found%20integer(int_on_box_borrow_local%E3%81%AF%E3%80%81i32%E3%82%92box%E5%8C%96%E3%81%97%E3%81%9F%E5%80%A4%E3%81%AE%E5%8F%82%E7%85%A7%E3%81%A0%E3%81%8B%E3%82%89%E3%80%81*int_on_box_borrow_local%E3%81%A8%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%93%E3%82%8C%E3%81%AF%20struct%20Box%E5%9E%8B%E3%81%8C%E8%BF%94%E3%81%95%E3%82%8C%E3%82%8B)%0A%20%20%20%20%2F%2F%20*int_on_box_borrow_local%20%3D%20102%3B%0A%0A%20%20%20%20%2F%2F%20%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B%20%E7%90%86%E7%94%B1%3A%20cannot%20assign%20to%20%60**int_on_box_borrow_local%60%2C%20which%20is%20behind%20a%20%60%26%60%20reference%0A%20%20%20%20%2F%2F%20**int_on_box_borrow_local%20%3D%20102%3B%0A%20%20%20%20%0A%20%20%20%20println!(%22int%20with%20boxed%3A%20int_on_box_borrow_local%3D%7B%7D%2C%20original%20%3D%20%7B%7D%22%2C%20int_on_box_borrow_local%2C%20int_on_box)%3B%0A%20%20%20%20%0A%20%20%20%20%2F%2F%20%E9%96%A2%E6%95%B0%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%82%92%E9%80%9A%E3%81%98%E3%81%A6%E5%80%A4%E3%81%AE%E5%80%9F%E7%94%A8%E3%82%92%E8%A9%A6%E3%81%99%0A%20%20%20%20awesome_borrow_with_box(%26int_on_box)%3B%0A%20%20%20%20%2F%2F%20L43%E3%81%AE%E9%96%A2%E6%95%B0%E5%AE%9F%E8%A1%8C%E3%81%8C%E7%B5%82%E4%BA%86%E3%81%97%E5%80%9F%E7%94%A8%E5%80%A4%E3%81%AE%E2%86%92%E5%85%83%E3%81%AE%E5%A4%89%E6%95%B0int_on_box%E3%81%AB%E6%96%B0%E3%81%97%E3%81%84%E5%80%A4%E3%82%92%E4%BB%A3%E5%85%A5%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84)%0A%20%20%20%20*int_on_box%20%3D%20103%3B%0A%20%20%20%20println!(%22int%20with%20boxed%3A%20original%20%3D%20%7B%7D%22%2C%20int_on_box)%3B%0A%0A%20%20%20%20let%20int_on_box_borrow_mut%20%3D%20%26mut%20int_on_box%3B%0A%20%20%20%20**int_on_box_borrow_mut%20%3D%20104%3B%0A%0A%20%20%20%20%2F%2F%20%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B%20%E7%90%86%E7%94%B1%3A%20error%5BE0502%5D%3A%20cannot%20borrow%20%60int_on_box%60%20as%20immutable%20because%20it%20is%20also%20borrowed%20as%20mutable%0A%20%20%20%20%2F%2F%20println!(%22int%20with%20boxed%3A%20int_on_box_borrow_mut%3D%7B%7D%2C%20original%20%3D%20%7B%7D%22%2C%20int_on_box_borrow_mut%2C%20int_on_box)%3B%0A%0A%20%20%20%20%2F%2F%20%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B%20%E7%90%86%E7%94%B1%3A%20error%5BE0499%5D%3A%20cannot%20borrow%20%60int_on_box%60%20as%20mutable%20more%20than%20once%20at%20a%20time%0A%20%20%20%20%2F%2F%20println!(%22int%20with%20boxed%3A%20int_on_box_borrow_mut%3D%7B%7D%2C%20original%20%3D%20%7B%7D%22%2C%20int_on_box_borrow_mut%2C%20%26mut%20int_on_box)%3B%0A%0A%20%20%20%20println!(%22int%20with%20boxed%3A%20int_on_box%3D%7B%7D%22%2C%20int_on_box)%3B%0A%7D%0A)

- æ„šç›´ã«ã€i32å‹ã®ãƒœãƒƒã‚¯ã‚¹åŒ–ã‚’ç·´ç¿’ã—ã¦ã¿ãŸã€‚
  - ã“ã‚“ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã¯ãªã„ã ã‚ã†ãŒã€ã‚ãã¾ã§ç·´ç¿’ã€‚
    - Box<T>ã—ãŸå¾Œã®å‚ç…§ãƒ»å€Ÿç”¨ã€ãã®å¾Œã®å€¤ã®æ›¸ãæ›ãˆã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ãƒã‚¤ãƒ³ãƒˆã‚’ã€æ•™ç§‘æ›¸çš„ã«ç¢ºèªã—ã¦ã„ãä½œæ¥­ã€‚
    - ãƒœãƒƒã‚¯ã‚¹åŒ–ã—ãŸå¾Œã‚’å‚ç…§ã—ã¦ã‹ã‚‰ä¸­èº«ã‚’æ›´æ–°ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¨ã€Cè¨€èªã®2é‡ãƒã‚¤ãƒ³ã‚¿ã«ä¼¼ãŸæ„Ÿã˜ã«ãªã‚‹ãªã€‚

```rust
fn awesome_borrow_with_box(int_on_box_borrow: &Box<i32>) -> bool {
    
    // ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ ç†ç”±: expected struct `Box`, found integer
    // *int_on_box_borrow = 101;

    // ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ ç†ç”±: cannot assign to `**int_on_box_borrow`, which is behind a `&` reference
    // **int_on_box_borrow = 101;

    println!("int with boxed: borrow = {}", int_on_box_borrow);
    true
}

fn main() {

    // é€šå¸¸ã®integer(ã‚¹ã‚¿ãƒƒã‚¯ä¸Šã«æ ¼ç´ã•ã‚Œã‚‹)
    let int_on_stack: i32 = 100;

    // å¤‰æ•°int_on_stack_copyã«ã‚³ãƒ”ãƒ¼ â€»å€¤ã®å¤‰æ›´ç¢ºèªã®ãŸã‚mutä¿®é£¾å­ã‚’ä»˜ä¸)
    let mut int_on_stack_copy = int_on_stack;
    println!("int on stack: copy is ok. original = {}, copy = {}.", int_on_stack, int_on_stack_copy);
    println!("int on stack: change value of int_on_stack_copy(from 100 to 50).");
    // 
    int_on_stack_copy = 50;
    println!("int on stack: copy is stored as different on stack. original = {}, copy = {}.", int_on_stack, int_on_stack_copy);

    let mut int_on_box: Box<i32> = std::boxed::Box::new(100);

    // boxåŒ–ã—ãŸå€¤ã®å‚ç…§ãƒ»å€Ÿç”¨ã®å‹•ä½œã‚’ç¢ºèª
    let int_on_box_borrow_local = &int_on_box;

    // ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ ç†ç”±: cannot assign to `*int_on_box` because it is borrowed (L29ã®å‚ç…§ã§å€¤ãŒå€Ÿç”¨ã•ã‚Œã¦ã„ã‚‹â†’å…ƒã®å¤‰æ•°int_on_boxã«æ–°ã—ã„å€¤ã‚’ä»£å…¥ã§ããªã„)
    // *int_on_box = 102;

    // ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ ç†ç”±: expected struct `Box`, found integer(int_on_box_borrow_localã¯ã€i32ã‚’boxåŒ–ã—ãŸå€¤ã®å‚ç…§ã ã‹ã‚‰ã€*int_on_box_borrow_localã¨æ›¸ãã¨ã“ã‚Œã¯ struct Boxå‹ãŒè¿”ã•ã‚Œã‚‹)
    // *int_on_box_borrow_local = 102;

    // ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ ç†ç”±: cannot assign to `**int_on_box_borrow_local`, which is behind a `&` reference
    // **int_on_box_borrow_local = 102;
    
    println!("int with boxed: int_on_box_borrow_local={}, original = {}", int_on_box_borrow_local, int_on_box);
    
    // é–¢æ•°ã®å‘¼ã³å‡ºã—ã‚’é€šã˜ã¦å€¤ã®å€Ÿç”¨ã‚’è©¦ã™
    awesome_borrow_with_box(&int_on_box);
    // L43ã®é–¢æ•°å®Ÿè¡ŒãŒçµ‚äº†ã—å€Ÿç”¨å€¤ã®â†’å…ƒã®å¤‰æ•°int_on_boxã«æ–°ã—ã„å€¤ã‚’ä»£å…¥ã§ããªã„)
    *int_on_box = 103;
    println!("int with boxed: original = {}", int_on_box);

    let int_on_box_borrow_mut = &mut int_on_box;
    **int_on_box_borrow_mut = 104;

    // ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ ç†ç”±: error[E0502]: cannot borrow `int_on_box` as immutable because it is also borrowed as mutable
    // println!("int with boxed: int_on_box_borrow_mut={}, original = {}", int_on_box_borrow_mut, int_on_box);

    // ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ ç†ç”±: error[E0499]: cannot borrow `int_on_box` as mutable more than once at a time
    // println!("int with boxed: int_on_box_borrow_mut={}, original = {}", int_on_box_borrow_mut, &mut int_on_box);

    println!("int with boxed: int_on_box={}", int_on_box);
}
```

- å®Ÿè¡Œçµæœ

```
int on stack: copy is ok. original = 100, copy = 100.
int on stack: change value of int_on_stack_copy(from 100 to 50).
int on stack: copy is stored as different on stack. original = 100, copy = 50.
int with boxed: int_on_box_borrow_local=100, original = 100
int with boxed: borrow = 100
int with boxed: original = 103
int with boxed: int_on_box=104
```

## ãŠã‚ã‚Šã«

æ‰€æœ‰æ¨©ãŒé›£ã—ã„ã€‚
å€Ÿã‚Šã‚‰ã‚Œã¦ã‚‹å¤‰æ•°ã‚’ä¸€ç¬å¿˜ã‚Œã¦println!ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ä¸æ„ã«ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã€å€Ÿç”¨ã€ã‚€ãšã‹ã—ã„ã€‚ã€‚ã¨ã„ã†æ°—æŒã¡ã«ãªã£ãŸã€‚



Rustã®æº€è¶³è¡Œãé–‹ç™ºãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§
ã¡ã‚‡ã£ã¨ãšã¤ã‚„ã£ã¦ã„ãã¾ã™ã€‚
